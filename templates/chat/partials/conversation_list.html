<!-- Conversations Section -->
<div class="mb-6">
    <!-- Conversations Header with New Button -->
    <div class="flex items-center justify-between mb-3">
        <button @click="toggleConversations()"
                class="flex items-center space-x-2 text-left hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 rounded-md p-1 -m-1 transition-colors duration-200"
                :aria-expanded="conversationsExpanded"
                :aria-label="conversationsExpanded ? 'Collapse conversations' : 'Expand conversations'"
                role="button"
                tabindex="0">
            <svg class="h-4 w-4 text-gray-500 transition-transform duration-200 transform"
                 :class="{ 'rotate-90': conversationsExpanded }"
                 fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
            <h3 class="text-sm font-medium text-gray-900">Conversations</h3>
        </button>
        
        <!-- New Conversation Button -->
        <button @click="createNewConversation()"
                class="p-1.5 text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-md transition-colors duration-200"
                title="New Conversation"
                aria-label="Create new conversation">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
        </button>
    </div>
    
    <!-- Collapsible Conversation List Container -->
    <div x-show="conversationsExpanded"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform scale-95 -translate-y-2"
         x-transition:enter-end="opacity-100 transform scale-100 translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform scale-100 translate-y-0"
         x-transition:leave-end="opacity-0 transform scale-95 -translate-y-2"
         class="overflow-hidden">
        
        <div id="conversation-list"
             hx-get="{% url 'chat:list_conversations' %}"
             hx-trigger="load, conversation-updated from:body"
             hx-swap="innerHTML"
             role="list"
             aria-label="List of conversations"
             class="space-y-2">
            
            <!-- Conversations will be loaded here -->
            {% for conversation in conversations %}
                {% include 'chat/partials/conversation_item.html' with conversation=conversation %}
            {% empty %}
                {% include 'chat/partials/conversation_list_empty.html' %}
            {% endfor %}
        </div>
    </div>
    
    <!-- Collapsed State Summary -->
    <div x-show="!conversationsExpanded && conversationCount > 0"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="text-center py-3">
        <p class="text-xs text-gray-500">
            <span x-text="conversationCount"></span> conversation<span x-show="conversationCount !== 1">s</span>
        </p>
        <button @click="toggleConversations()"
                class="mt-1 text-xs text-blue-600 hover:text-blue-700 hover:underline focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 rounded px-1"
                aria-label="Expand to view conversations">
            Click to view
        </button>
    </div>
</div>